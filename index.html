<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Interactive Multi-Table Data Display System</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            line-height: 1.8;
            padding: 20px;
            padding-top: 220px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            transition: background 0.3s ease;
        }

        body.dark-mode {
            background: linear-gradient(135deg, #2c3e50 0%, #34495e 100%);
        }

        body.dark-mode .container {
            background: #2c3e50;
            color: #ecf0f1;
        }

        body.dark-mode .content-section,
        body.dark-mode .table-container {
            background: #34495e;
            color: #ecf0f1;
        }

        body.dark-mode .search-bar-fixed {
            background: #2c3e50;
            color: #ecf0f1;
        }

        body.dark-mode h1,
        body.dark-mode h2 {
            color: #ecf0f1;
        }

        body.dark-mode .interactive-text {
            color: #ecf0f1;
        }

        body.dark-mode .dropdown-content,
        body.dark-mode .mode-dropdown-content {
            background: #34495e;
            color: #ecf0f1;
        }

        body.dark-mode .dropdown-item,
        body.dark-mode .mode-dropdown-item {
            color: #ecf0f1;
            border-bottom-color: #4a5f7f;
        }

        body.dark-mode .tab-content {
            background: #1a252f;
        }

        body.dark-mode table {
            background: #34495e;
        }

        body.dark-mode table thead {
            background: #667eea;
        }

        body.dark-mode table tbody tr {
            border-bottom: 1px solid #4a5f7f;
        }

        body.dark-mode table tbody tr:hover {
            background: #3d5a80;
        }

        .search-bar-fixed {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            background: white;
            box-shadow: 0 4px 20px rgba(0,0,0,0.15);
            z-index: 2000;
            padding: 20px;
        }

        .search-bar-content {
            max-width: 1400px;
            margin: 0 auto;
        }

        .top-controls {
            display: flex;
            gap: 15px;
            margin-bottom: 15px;
            flex-wrap: wrap;
            align-items: center;
        }

        .search-mode-dropdown {
            position: relative;
            display: inline-block;
        }

        .mode-dropdown-btn,
        .theme-toggle-btn,
        .font-control-btn {
            padding: 12px 24px;
            background: #27ae60;
            color: white;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 15px;
            font-weight: 600;
            display: inline-flex;
            align-items: center;
            gap: 10px;
            transition: all 0.3s ease;
        }

        .theme-toggle-btn {
            background: #9b59b6;
        }

        .font-control-btn {
            background: #3498db;
            padding: 12px 16px;
        }

        .mode-dropdown-btn:hover {
            background: #229954;
        }

        .theme-toggle-btn:hover {
            background: #8e44ad;
        }

        .font-control-btn:hover {
            background: #2980b9;
        }

        .mode-dropdown-content {
            display: none;
            position: absolute;
            background: white;
            min-width: 300px;
            box-shadow: 0 8px 30px rgba(0,0,0,0.2);
            border-radius: 8px;
            z-index: 3000;
            margin-top: 10px;
            max-height: 400px;
            overflow-y: auto;
        }

        .mode-dropdown-content.show {
            display: block;
        }

        .mode-dropdown-item {
            padding: 14px 20px;
            cursor: pointer;
            border-bottom: 1px solid #f0f0f0;
            transition: all 0.3s ease;
            color: #2c3e50;
        }

        .mode-dropdown-item:last-child {
            border-bottom: none;
        }

        .mode-dropdown-item:hover {
            background: #f8f9fa;
            color: #27ae60;
        }

        .mode-dropdown-item.active {
            background: #e8f8f0;
            color: #27ae60;
            font-weight: 600;
        }

        .search-history-dropdown {
            position: relative;
            display: inline-block;
        }

        .history-btn {
            padding: 12px 24px;
            background: #e67e22;
            color: white;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 15px;
            font-weight: 600;
            display: inline-flex;
            align-items: center;
            gap: 10px;
        }

        .history-btn:hover {
            background: #d35400;
        }

        .history-dropdown-content {
            display: none;
            position: absolute;
            background: white;
            min-width: 250px;
            box-shadow: 0 8px 30px rgba(0,0,0,0.2);
            border-radius: 8px;
            z-index: 3000;
            margin-top: 10px;
            max-height: 300px;
            overflow-y: auto;
        }

        .history-dropdown-content.show {
            display: block;
        }

        .history-item {
            padding: 12px 20px;
            cursor: pointer;
            border-bottom: 1px solid #f0f0f0;
            transition: all 0.3s ease;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .history-item:hover {
            background: #f8f9fa;
        }

        .history-clear {
            color: #e74c3c;
            font-size: 12px;
        }

        .search-container {
            display: flex;
            gap: 15px;
            align-items: center;
            flex-wrap: wrap;
        }

        .search-input-wrapper {
            flex: 1;
            min-width: 300px;
        }

        #searchInput {
            width: 100%;
            padding: 14px 20px;
            font-size: 16px;
            border: 2px solid #ddd;
            border-radius: 8px;
            transition: all 0.3s ease;
        }

        #searchInput:focus {
            outline: none;
            border-color: #27ae60;
            box-shadow: 0 0 0 3px rgba(39, 174, 96, 0.1);
        }

        .search-controls {
            display: flex;
            gap: 10px;
            align-items: center;
            flex-wrap: wrap;
        }

        .search-btn {
            padding: 12px 20px;
            background: #e74c3c;
            color: white;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 15px;
            font-weight: 600;
            transition: all 0.3s ease;
        }

        .search-btn:hover {
            background: #c0392b;
        }

        .nav-btn {
            padding: 12px 16px;
            background: #667eea;
            color: white;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 18px;
            transition: all 0.3s ease;
        }

        .nav-btn:hover:not(:disabled) {
            background: #764ba2;
        }

        .nav-btn:disabled {
            background: #95a5a6;
            cursor: not-allowed;
        }

        .search-info {
            padding: 12px 20px;
            background: #f8f9fa;
            border-radius: 8px;
            font-weight: 600;
            color: #2c3e50;
            border: 2px solid #ddd;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            background: white;
            padding: 50px;
            border-radius: 12px;
            box-shadow: 0 15px 50px rgba(0,0,0,0.25);
            transition: all 0.3s ease;
        }

        .font-size-6px { font-size: 6px; }
        .font-size-8px { font-size: 8px; }
        .font-size-10px { font-size: 10px; }
        .font-size-12px { font-size: 12px; }
        .font-size-14px { font-size: 14px; }
        .font-size-16px { font-size: 16px; }
        .font-size-18px { font-size: 18px; }

        h1 {
            color: #2c3e50;
            margin-bottom: 40px;
            text-align: center;
            font-size: 2.5em;
            font-weight: 600;
        }

        h2 {
            color: #34495e;
            margin-bottom: 25px;
            font-size: 1.8em;
            font-weight: 500;
        }

        .content-section {
            margin-bottom: 50px;
            padding: 35px;
            background: #f8f9fa;
            border-radius: 10px;
            border-left: 5px solid #667eea;
        }

        .interactive-text {
            font-size: 20px;
            line-height: 2;
            color: #2c3e50;
            letter-spacing: 0.3px;
        }

        .highlight {
            position: relative;
            display: inline;
            color: #3498db;
            cursor: pointer;
            text-decoration: none;
            border-bottom: 1px solid #3498db;
            transition: all 0.3s ease;
        }

        .highlight:hover {
            color: #2980b9;
            border-bottom-color: #2980b9;
        }

        .search-highlight {
            background-color: #ffeb3b;
            padding: 2px 4px;
            border-radius: 3px;
            font-weight: bold;
        }

        .search-highlight.current {
            background-color: #ff9800;
            color: white;
        }

        .tooltip {
            display: none;
            position: absolute;
            bottom: 130%;
            left: 50%;
            transform: translateX(-50%);
            background: #2c3e50;
            color: white;
            padding: 20px;
            border-radius: 10px;
            width: 340px;
            box-shadow: 0 8px 30px rgba(0,0,0,0.35);
            z-index: 5000;
        }

        .tooltip.active {
            display: block;
            animation: fadeIn 0.3s ease;
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateX(-50%) translateY(-10px);
            }
            to {
                opacity: 1;
                transform: translateX(-50%) translateY(0);
            }
        }

        .tooltip::after {
            content: '';
            position: absolute;
            top: 100%;
            left: 50%;
            transform: translateX(-50%);
            border: 10px solid transparent;
            border-top-color: #2c3e50;
        }

        .tooltip-header {
            font-size: 12px;
            color: #95a5a6;
            margin-bottom: 10px;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .tooltip-content {
            margin-bottom: 15px;
            font-size: 15px;
            line-height: 1.6;
            padding: 10px;
            background: rgba(255,255,255,0.1);
            border-radius: 6px;
        }

        .remark-link {
            color: #667eea;
            text-decoration: none;
            font-weight: bold;
            cursor: pointer;
            display: inline-block;
            padding: 8px 16px;
            background: white;
            border-radius: 6px;
            transition: all 0.3s ease;
            font-size: 14px;
        }

        .remark-link:hover {
            background: #667eea;
            color: white;
        }

        .remark-text {
            display: none;
            margin-top: 12px;
            padding: 12px;
            background: white;
            border-left: 4px solid #667eea;
            border-radius: 6px;
            color: #2c3e50;
            font-size: 14px;
            line-height: 1.6;
        }

        .remark-text.visible {
            display: block;
        }

        .controls {
            margin: 30px 0;
            text-align: center;
            display: flex;
            gap: 15px;
            justify-content: center;
            flex-wrap: wrap;
        }

        .dropdown-container {
            display: inline-block;
            position: relative;
        }

        .dropdown-btn {
            background: #667eea;
            color: white;
            border: none;
            padding: 14px 32px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 17px;
            font-weight: 600;
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(102, 126, 234, 0.3);
            display: inline-flex;
            align-items: center;
            gap: 10px;
        }

        .dropdown-btn:hover {
            background: #764ba2;
        }

        .dropdown-content {
            display: none;
            position: absolute;
            background: white;
            min-width: 320px;
            box-shadow: 0 8px 30px rgba(0,0,0,0.2);
            border-radius: 8px;
            z-index: 1000;
            margin-top: 10px;
            max-height: 400px;
            overflow-y: auto;
        }

        .dropdown-content.show {
            display: block;
        }

        .dropdown-item {
            padding: 14px 20px;
            cursor: pointer;
            transition: all 0.3s ease;
            color: #2c3e50;
            border-bottom: 1px solid #f0f0f0;
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .dropdown-item:last-child {
            border-bottom: none;
        }

        .dropdown-item:hover {
            background: #f8f9fa;
        }

        .dropdown-item input[type="checkbox"] {
            width: 20px;
            height: 20px;
            cursor: pointer;
        }

        .dropdown-item label {
            flex: 1;
            cursor: pointer;
            font-size: 15px;
        }

        .bulk-controls {
            padding: 10px 20px;
            background: #ecf0f1;
            border-bottom: 2px solid #bdc3c7;
            display: flex;
            gap: 10px;
        }

        .bulk-btn {
            padding: 8px 16px;
            background: #3498db;
            color: white;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-size: 13px;
            font-weight: 600;
        }

        .bulk-btn:hover {
            background: #2980b9;
        }

        .table-section {
            margin-top: 40px;
            display: none;
        }

        .table-section.visible {
            display: block;
            animation: fadeInUp 0.4s ease;
        }

        @keyframes fadeInUp {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .table-container {
            margin-bottom: 50px;
            padding: 30px;
            background: #f8f9fa;
            border-radius: 10px;
            border-left: 5px solid #667eea;
        }

        .format-tabs {
            display: flex;
            gap: 12px;
            margin-bottom: 25px;
            flex-wrap: wrap;
            align-items: center;
        }

        .tab-btn {
            padding: 12px 24px;
            background: #e8e8e8;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-weight: 600;
            font-size: 15px;
            color: #555;
        }

        .tab-btn.active {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }

        .tab-btn:hover:not(.active) {
            background: #d5d5d5;
        }

        .copy-btn {
            padding: 10px 20px;
            background: #27ae60;
            color: white;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 600;
            margin-left: auto;
        }

        .copy-btn:hover {
            background: #229954;
        }

        .copy-btn.copied {
            background: #2ecc71;
        }

        .tab-content {
            display: none;
            padding: 25px;
            background: #2c3e50;
            border-radius: 10px;
            white-space: pre-wrap;
            font-family: 'Courier New', monospace;
            font-size: 14px;
            overflow-x: auto;
            color: #ecf0f1;
            line-height: 1.6;
        }

        .tab-content.active {
            display: block;
        }

        .table-view {
            display: none;
            overflow-x: auto;
        }

        .table-view.active {
            display: block;
        }

        table {
            width: 100%;
            border-collapse: collapse;
            background: white;
            border-radius: 8px;
            overflow: hidden;
        }

        table thead {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }

        table th {
            padding: 15px;
            text-align: left;
            font-weight: 600;
            cursor: pointer;
            user-select: none;
            position: relative;
        }

        table th:hover {
            background: rgba(255,255,255,0.1);
        }

        table th.sortable::after {
            content: ' ‚áÖ';
            opacity: 0.5;
        }

        table th.sort-asc::after {
            content: ' ‚Üë';
            opacity: 1;
        }

        table th.sort-desc::after {
            content: ' ‚Üì';
            opacity: 1;
        }

        table tbody tr {
            border-bottom: 1px solid #ecf0f1;
            transition: all 0.2s ease;
        }

        table tbody tr:hover {
            background: #f8f9fa;
            transform: scale(1.01);
        }

        table td {
            padding: 12px 15px;
            color: #2c3e50;
        }

        .export-btn {
            padding: 12px 24px;
            background: #e67e22;
            color: white;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 15px;
            font-weight: 600;
            transition: all 0.3s ease;
        }

        .export-btn:hover {
            background: #d35400;
        }

        .import-btn {
            padding: 12px 24px;
            background: #16a085;
            color: white;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 15px;
            font-weight: 600;
            transition: all 0.3s ease;
        }

        .import-btn:hover {
            background: #138d75;
        }

        .back-to-top {
            position: fixed;
            bottom: 35px;
            right: 35px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            width: 55px;
            height: 55px;
            border-radius: 50%;
            border: none;
            cursor: pointer;
            font-size: 26px;
            box-shadow: 0 6px 25px rgba(102, 126, 234, 0.5);
            transition: all 0.3s ease;
            opacity: 0;
            visibility: hidden;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .back-to-top.visible {
            opacity: 1;
            visibility: visible;
        }

        .back-to-top:hover {
            transform: translateY(-8px);
        }

        .note {
            margin-top: 20px;
            padding: 15px 20px;
            background: #e8f4f8;
            border-left: 4px solid #3498db;
            border-radius: 6px;
            font-size: 15px;
            color: #2c3e50;
        }

        .keyboard-hint {
            position: fixed;
            bottom: 100px;
            right: 35px;
            background: #34495e;
            color: white;
            padding: 15px 20px;
            border-radius: 8px;
            font-size: 13px;
            opacity: 0;
            visibility: hidden;
            transition: all 0.3s ease;
            max-width: 250px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.3);
        }

        .keyboard-hint.visible {
            opacity: 1;
            visibility: visible;
        }

        .keyboard-hint kbd {
            background: #2c3e50;
            padding: 3px 8px;
            border-radius: 4px;
            font-family: monospace;
            border: 1px solid #95a5a6;
        }

        #fileInput {
            display: none;
        }
    </style>
</head>
<body>
    <div class="search-bar-fixed">
        <div class="search-bar-content">
            <div class="top-controls">
                <div class="search-mode-dropdown">
                    <button class="mode-dropdown-btn" id="modeDropdownBtn">
                        <span id="currentMode">Search All</span>
                        <span>‚ñº</span>
                    </button>
                    <div class="mode-dropdown-content" id="modeDropdown">
                        <div class="mode-dropdown-item active" data-mode="1">Search All (Content + Tables)</div>
                        <div class="mode-dropdown-item" data-mode="2">Content Only</div>
                        <div class="mode-dropdown-item" data-mode="3">Tables Only</div>
                        <div class="mode-dropdown-item" data-mode="4">Selected Tables</div>
                        <div class="mode-dropdown-item" data-mode="5">Filter Selected Tables</div>
                        <div class="mode-dropdown-item" data-mode="6">Filter All Tables</div>
                    </div>
                </div>
                
                <div class="search-history-dropdown">
                    <button class="history-btn" id="historyBtn">
                        <span>üìú History</span>
                        <span>‚ñº</span>
                    </button>
                    <div class="history-dropdown-content" id="historyDropdown"></div>
                </div>

                <button class="theme-toggle-btn" id="themeToggle">
                    <span id="themeIcon">üåô</span>
                    <span>Dark Mode</span>
                </button>

                <button class="font-control-btn" id="fontDecrease" title="Decrease font size">A-</button>
                <button class="font-control-btn" id="fontIncrease" title="Increase font size">A+</button>
            </div>

            <div class="search-container">
                <div class="search-input-wrapper">
                    <input type="text" id="searchInput" placeholder="Real-time search - Start typing... (Ctrl+F)" />
                </div>
                <div class="search-controls">
                    <button class="nav-btn" id="prevBtn" disabled title="Previous match (Shift+Enter)">‚óÑ</button>
                    <span class="search-info" id="searchInfo">0 results</span>
                    <button class="nav-btn" id="nextBtn" disabled title="Next match (Enter)">‚ñ∫</button>
                    <button class="search-btn" id="clearBtn" title="Clear search (Esc)">Clear</button>
                </div>
            </div>
        </div>
    </div>

    <div class="container">
        <h1 id="top">üìä Interactive Multi-Table Data Display System</h1>

        <div class="content-section">
            <h2>System Analysis Report</h2>
            <div class="interactive-text" id="contentText">
                The system has processed multiple data entries across different validation tables. From Table 1, item T1-1.0 has been validated successfully. Entry T1-2.0 demonstrates improved metrics. The testing phase included T1-3.0 which revealed important insights. Advanced testing with T1-1.1a shows excellent modular performance. Requirement T1-2.3.1 has been fully documented and approved. From the security validation table, authentication module T2-1.0 passed security audits. The encryption framework T2-2.0 meets compliance standards. The access control system T2-3.0 demonstrates robust implementation. Advanced threat detection T2-1.2b exceeds performance benchmarks. Multi-factor authentication enhancement T2-3.1.2 successfully integrates with existing systems. Performance testing from Table 3 shows T3-1.0 met all benchmarks and T3-2.5a exceeded expectations. Infrastructure review T3-4.2.1 completed successfully.
            </div>
            <div class="note">
                <strong>üí° Tip:</strong> Click blue references for details. Use Ctrl+F to search, Esc to close tooltips, arrow keys to navigate.
            </div>
        </div>

        <div class="controls">
            <div class="dropdown-container">
                <button class="dropdown-btn" id="tableDropdownBtn">
                    üìã Select Tables
                    <span>‚ñº</span>
                </button>
                <div class="dropdown-content" id="tableDropdown">
                    <div class="bulk-controls">
                        <button class="bulk-btn" id="selectAll">Select All</button>
                        <button class="bulk-btn" id="deselectAll">Deselect All</button>
                    </div>
                </div>
            </div>

            <button class="export-btn" id="exportBtn">üíæ Export Data</button>
            <button class="import-btn" id="importBtn">üìÅ Import Data</button>
            <input type="file" id="fileInput" accept=".json,.csv" />
        </div>

        <div id="tablesContainer"></div>
    </div>

    <button class="back-to-top" id="backToTop" title="Back to top">‚Üë</button>
    
    <div class="keyboard-hint" id="keyboardHint">
        <strong>Keyboard Shortcuts:</strong><br>
        <kbd>Ctrl+F</kbd> Search<br>
        <kbd>Esc</kbd> Close/Clear<br>
        <kbd>‚Üë</kbd><kbd>‚Üì</kbd> Navigate<br>
        <kbd>Enter</kbd> Next match
    </div>

    <script>
        var APP = {
            currentActiveTooltip: null,
            searchMatches: [],
            currentMatchIndex: -1,
            originalContent: '',
            currentSearchMode: 1,
            selectedTables: [],
            originalTableData: {},
            searchHistory: [],
            maxHistorySize: 10,
            fontSize: '12px',
            sortStates: {},
            debounceTimer: null,
            
            tableData: {
                "T1": [
                    {"ID": "1.0", "TEXT": "This is the primary content entry that serves as the baseline for all subsequent validations and quality checks.", "REMARK": "This entry passed all validation checks and meets the expected quality standards for production deployment.", "STATUS": "Approved", "PRIORITY": "High", "DATE": "2025-01-10"},
                    {"ID": "2.0", "TEXT": "Secondary validation entry containing enhanced metadata and additional context for comprehensive system analysis.", "REMARK": "This entry shows improved performance metrics compared to baseline and is approved for integration.", "STATUS": "Approved", "PRIORITY": "Medium", "DATE": "2025-01-11"},
                    {"ID": "3.0", "TEXT": "Critical test case data demonstrating system behavior under edge conditions and stress scenarios.", "REMARK": "Edge case testing revealed minor inconsistencies that require monitoring in production environment.", "STATUS": "Review", "PRIORITY": "High", "DATE": "2025-01-12"},
                    {"ID": "1.1a", "TEXT": "Advanced sub-component testing with alphanumeric identifiers for modular system verification.", "REMARK": "Sub-component passed all unit tests and integration requirements with excellent performance.", "STATUS": "Approved", "PRIORITY": "Medium", "DATE": "2025-01-13"},
                    {"ID": "2.3.1", "TEXT": "Requirement specification for multi-tiered validation process with hierarchical dependencies.", "REMARK": "All requirements documented and approved by stakeholders. Ready for implementation phase.", "STATUS": "Approved", "PRIORITY": "High", "DATE": "2025-01-14"}
                ],
                "T2": [
                    {"ID": "1.0", "TEXT": "Primary authentication module implementing multi-factor authentication with biometric support and OAuth integration.", "REMARK": "Security audit completed successfully. All authentication flows meet industry standards and compliance requirements.", "STATUS": "Certified", "SECURITY_LEVEL": "High", "COMPLIANCE": "SOC2, ISO27001"},
                    {"ID": "2.0", "TEXT": "End-to-end encryption system using AES-256 with RSA key exchange and perfect forward secrecy implementation.", "REMARK": "Encryption strength verified through penetration testing. No vulnerabilities detected in current implementation.", "STATUS": "Certified", "SECURITY_LEVEL": "Critical", "COMPLIANCE": "FIPS 140-2"},
                    {"ID": "3.0", "TEXT": "Role-based access control (RBAC) system with granular permissions and audit logging capabilities.", "REMARK": "Access control policies validated against security framework. All permission hierarchies properly implemented.", "STATUS": "Certified", "SECURITY_LEVEL": "High", "COMPLIANCE": "GDPR, CCPA"},
                    {"ID": "1.2b", "TEXT": "Advanced threat detection system with machine learning capabilities for anomaly identification.", "REMARK": "Threat detection algorithms tested against known attack patterns. Detection rate exceeds 99.5%.", "STATUS": "Certified", "SECURITY_LEVEL": "Critical", "COMPLIANCE": "ISO27001, NIST"},
                    {"ID": "3.1.2", "TEXT": "Multi-factor authentication enhancement with time-based one-time password (TOTP) integration.", "REMARK": "TOTP implementation follows RFC 6238 standards. Successfully integrated with existing auth system.", "STATUS": "Certified", "SECURITY_LEVEL": "High", "COMPLIANCE": "PCI-DSS"}
                ],
                "T3": [
                    {"ID": "1.0", "TEXT": "Performance benchmarking suite for system load testing and stress analysis under various conditions.", "REMARK": "All performance metrics met target thresholds. System handles expected load with 20% overhead capacity.", "STATUS": "Passed", "METRIC": "Load Test", "RESULT": "95% Success"},
                    {"ID": "2.5a", "TEXT": "Database optimization and query performance analysis for high-throughput operations.", "REMARK": "Query optimization reduced average response time by 40%. Indexing strategy implemented successfully.", "STATUS": "Passed", "METRIC": "DB Performance", "RESULT": "Excellent"},
                    {"ID": "4.2.1", "TEXT": "Infrastructure scalability testing for horizontal and vertical scaling capabilities.", "REMARK": "Auto-scaling policies validated. System successfully scales from 2 to 20 instances under load.", "STATUS": "Passed", "METRIC": "Scalability", "RESULT": "100% Success"}
                ]
            },
            
            tableNames: {
                'T1': 'System Validation Data',
                'T2': 'Security Validation Data',
                'T3': 'Performance Testing Data'
            }
        };

        // Load saved preferences
        function loadPreferences() {
            var savedTheme = localStorage.getItem('theme');
            if (savedTheme === 'dark') {
                document.body.classList.add('dark-mode');
                document.getElementById('themeIcon').textContent = '‚òÄÔ∏è';
            }
            
            var savedFontSize = localStorage.getItem('fontSize');
            if (savedFontSize) {
                APP.fontSize = savedFontSize;
                document.body.classList.add('font-size-' + savedFontSize);
            }
            
            var savedHistory = localStorage.getItem('searchHistory');
            if (savedHistory) {
                APP.searchHistory = JSON.parse(savedHistory);
            }
        }

        // Save search to history
        function saveSearchToHistory(searchTerm) {
            if (!searchTerm || searchTerm.length < 2) return;
            
            if (APP.searchHistory.indexOf(searchTerm) === -1) {
                APP.searchHistory.unshift(searchTerm);
                if (APP.searchHistory.length > APP.maxHistorySize) {
                    APP.searchHistory.pop();
                }
                localStorage.setItem('searchHistory', JSON.stringify(APP.searchHistory));
                updateHistoryDropdown();
            }
        }

        // Update history dropdown
        function updateHistoryDropdown() {
            var dropdown = document.getElementById('historyDropdown');
            dropdown.innerHTML = '';
            
            if (APP.searchHistory.length === 0) {
                var emptyItem = document.createElement('div');
                emptyItem.className = 'history-item';
                emptyItem.textContent = 'No search history';
                emptyItem.style.color = '#95a5a6';
                dropdown.appendChild(emptyItem);
                return;
            }
            
            for (var i = 0; i < APP.searchHistory.length; i++) {
                var item = document.createElement('div');
                item.className = 'history-item';
                item.textContent = APP.searchHistory[i];
                item.setAttribute('data-search', APP.searchHistory[i]);
                dropdown.appendChild(item);
            }
            
            var clearItem = document.createElement('div');
            clearItem.className = 'history-item history-clear';
            clearItem.textContent = 'Clear History';
            clearItem.style.borderTop = '2px solid #e74c3c';
            clearItem.style.marginTop = '5px';
            dropdown.appendChild(clearItem);
        }

        // Python-inspired data transformation functions
        function toJSON(tableName) {
            return JSON.stringify(APP.tableData[tableName], null, 2);
        }

        function toCSV(tableName) {
            var data = APP.tableData[tableName];
            if (data.length === 0) return '';
            
            var columns = Object.keys(data[0]);
            var csv = columns.join(',') + '\n';
            
            for (var i = 0; i < data.length; i++) {
                var row = data[i];
                var values = [];
                for (var j = 0; j < columns.length; j++) {
                    var value = String(row[columns[j]] || '').replace(/"/g, '""');
                    values.push('"' + value + '"');
                }
                csv += values.join(',') + '\n';
            }
            return csv;
        }

        function toMarkdown(tableName) {
            var data = APP.tableData[tableName];
            if (data.length === 0) return '';
            
            var columns = Object.keys(data[0]);
            var md = '| ' + columns.join(' | ') + ' |\n';
            md += '|' + columns.map(function() { return '---'; }).join('|') + '|\n';
            
            for (var i = 0; i < data.length; i++) {
                var row = data[i];
                var values = [];
                for (var j = 0; j < columns.length; j++) {
                    values.push(row[columns[j]] || '');
                }
                md += '| ' + values.join(' | ') + ' |\n';
            }
            return md;
        }

        function toHTMLTable(tableName) {
            var data = APP.tableData[tableName];
            if (data.length === 0) return '<p>No data available</p>';
            
            var columns = Object.keys(data[0]);
            var table = document.createElement('table');
            
            var thead = document.createElement('thead');
            var headerRow = document.createElement('tr');
            for (var i = 0; i < columns.length; i++) {
                var th = document.createElement('th');
                th.textContent = columns[i];
                th.className = 'sortable';
                th.setAttribute('data-column', columns[i]);
                th.setAttribute('data-table', tableName);
                headerRow.appendChild(th);
            }
            thead.appendChild(headerRow);
            table.appendChild(thead);
            
            var tbody = document.createElement('tbody');
            for (var i = 0; i < data.length; i++) {
                var row = document.createElement('tr');
                for (var j = 0; j < columns.length; j++) {
                    var td = document.createElement('td');
                    td.textContent = data[i][columns[j]] || '';
                    row.appendChild(td);
                }
                tbody.appendChild(row);
            }
            table.appendChild(tbody);
            
            return table;
        }

        function getData(tableName, id) {
            var data = APP.tableData[tableName];
            if (!data) return null;
            for (var i = 0; i < data.length; i++) {
                if (data[i].ID === id) {
                    return data[i];
                }
            }
            return null;
        }

        function escapeRegex(str) {
            return str.replace(/[.*+?^${}()|[\]\\]/g, '\\                    {"ID": "2.3.1", "TEXT": "Requirement specification for multi-tiered validation process with hierarchical dependencies.", "');
        }

        // Copy to clipboard
        function copyToClipboard(text, button) {
            var textarea = document.createElement('textarea');
            textarea.value = text;
            document.body.appendChild(textarea);
            textarea.select();
            document.execCommand('copy');
            document.body.removeChild(textarea);
            
            var originalText = button.textContent;
            button.textContent = '‚úì Copied!';
            button.classList.add('copied');
            
            setTimeout(function() {
                button.textContent = originalText;
                button.classList.remove('copied');
            }, 2000);
        }

        // Sort table
        function sortTable(tableName, column, direction) {
            var data = APP.tableData[tableName];
            
            data.sort(function(a, b) {
                var aVal = a[column];
                var bVal = b[column];
                
                if (typeof aVal === 'string') aVal = aVal.toLowerCase();
                if (typeof bVal === 'string') bVal = bVal.toLowerCase();
                
                if (aVal < bVal) return direction === 'asc' ? -1 : 1;
                if (aVal > bVal) return direction === 'asc' ? 1 : -1;
                return 0;
            });
            
            updateTableView(tableName);
        }

        function updateTableView(tableName) {
            var tableView = document.getElementById(tableName + '-table-view');
            if (tableView && tableView.classList.contains('active')) {
                tableView.innerHTML = '';
                tableView.appendChild(toHTMLTable(tableName));
            }
        }

        // Initialize dropdown with checkboxes
        function initializeDropdown() {
            var dropdown = document.getElementById('tableDropdown');
            var tableKeys = Object.keys(APP.tableData);
            
            for (var i = 0; i < tableKeys.length; i++) {
                var tableKey = tableKeys[i];
                var item = document.createElement('div');
                item.className = 'dropdown-item';
                
                var checkbox = document.createElement('input');
                checkbox.type = 'checkbox';
                checkbox.id = 'check-' + tableKey;
                checkbox.setAttribute('data-table', tableKey);
                
                var label = document.createElement('label');
                label.htmlFor = 'check-' + tableKey;
                label.textContent = 'Table ' + tableKey + ': ' + APP.tableNames[tableKey];
                
                item.appendChild(checkbox);
                item.appendChild(label);
                dropdown.appendChild(item);
            }
        }

        // Initialize all tables
        function initializeTables() {
            var container = document.getElementById('tablesContainer');
            var tableKeys = Object.keys(APP.tableData);
            
            container.innerHTML = '';
            for (var i = 0; i < tableKeys.length; i++) {
                var tableKey = tableKeys[i];
                APP.originalTableData[tableKey] = JSON.parse(JSON.stringify(APP.tableData[tableKey]));
                APP.sortStates[tableKey] = {};
                
                var section = document.createElement('div');
                section.className = 'table-section';
                section.id = 'tableSection' + tableKey;
                
                var tableContainer = document.createElement('div');
                tableContainer.className = 'table-container';
                
                var heading = document.createElement('h2');
                heading.id = 'dataTable' + tableKey;
                heading.textContent = 'Table ' + tableKey + ': ' + APP.tableNames[tableKey];
                
                var formatTabs = document.createElement('div');
                formatTabs.className = 'format-tabs';
                
                var jsonBtn = document.createElement('button');
                jsonBtn.className = 'tab-btn active';
                jsonBtn.textContent = 'JSON';
                jsonBtn.setAttribute('data-table', tableKey);
                jsonBtn.setAttribute('data-format', 'json');
                
                var csvBtn = document.createElement('button');
                csvBtn.className = 'tab-btn';
                csvBtn.textContent = 'CSV';
                csvBtn.setAttribute('data-table', tableKey);
                csvBtn.setAttribute('data-format', 'csv');
                
                var mdBtn = document.createElement('button');
                mdBtn.className = 'tab-btn';
                mdBtn.textContent = 'Markdown';
                mdBtn.setAttribute('data-table', tableKey);
                mdBtn.setAttribute('data-format', 'markdown');
                
                var tableBtn = document.createElement('button');
                tableBtn.className = 'tab-btn';
                tableBtn.textContent = 'Table';
                tableBtn.setAttribute('data-table', tableKey);
                tableBtn.setAttribute('data-format', 'table');
                
                var copyBtn = document.createElement('button');
                copyBtn.className = 'copy-btn';
                copyBtn.textContent = 'üìã Copy';
                copyBtn.setAttribute('data-table', tableKey);
                
                formatTabs.appendChild(jsonBtn);
                formatTabs.appendChild(csvBtn);
                formatTabs.appendChild(mdBtn);
                formatTabs.appendChild(tableBtn);
                formatTabs.appendChild(copyBtn);
                
                var jsonDiv = document.createElement('div');
                jsonDiv.id = tableKey + '-json';
                jsonDiv.className = 'tab-content active';
                
                var csvDiv = document.createElement('div');
                csvDiv.id = tableKey + '-csv';
                csvDiv.className = 'tab-content';
                
                var mdDiv = document.createElement('div');
                mdDiv.id = tableKey + '-markdown';
                mdDiv.className = 'tab-content';
                
                var tableView = document.createElement('div');
                tableView.id = tableKey + '-table-view';
                tableView.className = 'table-view';
                
                tableContainer.appendChild(heading);
                tableContainer.appendChild(formatTabs);
                tableContainer.appendChild(jsonDiv);
                tableContainer.appendChild(csvDiv);
                tableContainer.appendChild(mdDiv);
                tableContainer.appendChild(tableView);
                
                section.appendChild(tableContainer);
                container.appendChild(section);
            }
            
            updateAllTableFormats();
        }

        function updateAllTableFormats() {
            var tableKeys = Object.keys(APP.tableData);
            for (var i = 0; i < tableKeys.length; i++) {
                var table = tableKeys[i];
                var jsonEl = document.getElementById(table + '-json');
                var csvEl = document.getElementById(table + '-csv');
                var mdEl = document.getElementById(table + '-markdown');
                var tableView = document.getElementById(table + '-table-view');
                
                if (jsonEl) jsonEl.textContent = toJSON(table);
                if (csvEl) csvEl.textContent = toCSV(table);
                if (mdEl) mdEl.textContent = toMarkdown(table);
                if (tableView) {
                    tableView.innerHTML = '';
                    tableView.appendChild(toHTMLTable(table));
                }
            }
        }

        // Parse text and convert T1-1.0 patterns to hyperlinks
        function parseAndConvertReferences() {
            var contentText = document.getElementById('contentText');
            var html = contentText.innerHTML;
            var pattern = /\b(T\d+)-([\w.:]+)\b/g;
            
            html = html.replace(pattern, function(match, table, id) {
                var data = getData(table, id);
                if (data) {
                    return '<a class="highlight" data-table="' + table + '" data-id="' + id + '">' + match + '</a>';
                }
                return match;
            });
            
            contentText.innerHTML = html;
            APP.originalContent = html;
        }

        // Initialize tooltips for all hyperlinks
        function initializeTooltips() {
            var highlights = document.querySelectorAll('.highlight');
            for (var i = 0; i < highlights.length; i++) {
                var highlight = highlights[i];
                
                var existingTooltip = highlight.querySelector('.tooltip');
                if (existingTooltip) {
                    highlight.removeChild(existingTooltip);
                }
                
                var table = highlight.getAttribute('data-table');
                var id = highlight.getAttribute('data-id');
                var data = getData(table, id);
                
                if (data) {
                    var tooltip = document.createElement('span');
                    tooltip.className = 'tooltip';
                    
                    var tooltipHeader = document.createElement('div');
                    tooltipHeader.className = 'tooltip-header';
                    tooltipHeader.textContent = 'Table ' + table + ' - ID ' + id;
                    
                    var tooltipContent = document.createElement('div');
                    tooltipContent.className = 'tooltip-content';
                    tooltipContent.textContent = data.TEXT;
                    
                    var remarkLink = document.createElement('a');
                    remarkLink.className = 'remark-link';
                    remarkLink.textContent = 'View Remark';
                    
                    var remarkText = document.createElement('div');
                    remarkText.className = 'remark-text';
                    remarkText.textContent = data.REMARK;
                    
                    tooltip.appendChild(tooltipHeader);
                    tooltip.appendChild(tooltipContent);
                    tooltip.appendChild(remarkLink);
                    tooltip.appendChild(remarkText);
                    highlight.appendChild(tooltip);
                }
            }
            
            attachHighlightHandlers();
        }

        function attachHighlightHandlers() {
            var highlights = document.querySelectorAll('.highlight');
            for (var i = 0; i < highlights.length; i++) {
                highlights[i].onclick = function(e) {
                    e.preventDefault();
                    e.stopPropagation();
                    var tooltip = this.querySelector('.tooltip');
                    
                    if (APP.currentActiveTooltip && APP.currentActiveTooltip !== tooltip) {
                        APP.currentActiveTooltip.classList.remove('active');
                        var prevRemark = APP.currentActiveTooltip.querySelector('.remark-text');
                        if (prevRemark) {
                            prevRemark.classList.remove('visible');
                        }
                    }
                    
                    tooltip.classList.toggle('active');
                    
                    if (tooltip.classList.contains('active')) {
                        APP.currentActiveTooltip = tooltip;
                    } else {
                        APP.currentActiveTooltip = null;
                    }
                };
            }
        }

        // Debounced search
        function debouncedSearch(searchTerm) {
            clearTimeout(APP.debounceTimer);
            APP.debounceTimer = setTimeout(function() {
                performSearch(searchTerm);
            }, 300);
        }

        // Search functionality
        function performSearch(searchTerm) {
            if (!searchTerm) {
                clearSearch();
                return;
            }

            saveSearchToHistory(searchTerm);
            clearSearchHighlights();
            APP.searchMatches = [];
            
            var contentText = document.getElementById('contentText');
            var pattern = escapeRegex(searchTerm);
            var regex = new RegExp('(' + pattern + ')', 'gi');

            if (APP.currentSearchMode === 1 || APP.currentSearchMode === 2) {
                var highlightedContent = contentText.innerHTML.replace(regex, '<span class="search-highlight">$1</span>');
                contentText.innerHTML = highlightedContent;
                initializeTooltips();
            }

            if (APP.currentSearchMode === 1 || APP.currentSearchMode === 3 || APP.currentSearchMode === 4) {
                var tablesToSearch = APP.currentSearchMode === 4 ? APP.selectedTables : Object.keys(APP.tableData);
                for (var i = 0; i < tablesToSearch.length; i++) {
                    var table = tablesToSearch[i];
                    var jsonDiv = document.getElementById(table + '-json');
                    if (jsonDiv) {
                        var originalText = toJSON(table);
                        var highlighted = originalText.replace(regex, '<span class="search-highlight">$1</span>');
                        jsonDiv.innerHTML = highlighted;
                    }
                }
            }

            if (APP.currentSearchMode === 5 || APP.currentSearchMode === 6) {
                var tablesToFilter = APP.currentSearchMode === 5 ? APP.selectedTables : Object.keys(APP.tableData);
                for (var i = 0; i < tablesToFilter.length; i++) {
                    filterTable(tablesToFilter[i], searchTerm);
                }
            }

            APP.searchMatches = Array.from(document.querySelectorAll('.search-highlight'));
            updateSearchInfo();
            
            if (APP.searchMatches.length > 0) {
                APP.currentMatchIndex = 0;
                highlightCurrentMatch();
            }
        }

        function filterTable(table, searchTerm) {
            var filtered = [];
            var original = APP.originalTableData[table];
            for (var i = 0; i < original.length; i++) {
                var row = original[i];
                var values = Object.keys(row).map(function(key) { return row[key]; });
                for (var j = 0; j < values.length; j++) {
                    if (String(values[j]).toLowerCase().indexOf(searchTerm.toLowerCase()) !== -1) {
                        filtered.push(row);
                        break;
                    }
                }
            }
            
            APP.tableData[table] = filtered;
            
            var pattern = escapeRegex(searchTerm);
            var regex = new RegExp('(' + pattern + ')', 'gi');
            var jsonText = toJSON(table);
            var highlighted = jsonText.replace(regex, '<span class="search-highlight">$1</span>');
            
            var jsonEl = document.getElementById(table + '-json');
            var csvEl = document.getElementById(table + '-csv');
            var mdEl = document.getElementById(table + '-markdown');
            var tableView = document.getElementById(table + '-table-view');
            
            if (jsonEl) jsonEl.innerHTML = highlighted;
            if (csvEl) csvEl.textContent = toCSV(table);
            if (mdEl) mdEl.textContent = toMarkdown(table);
            if (tableView) {
                tableView.innerHTML = '';
                tableView.appendChild(toHTMLTable(table));
            }
        }

        function clearSearchHighlights() {
            var contentText = document.getElementById('contentText');
            if (APP.originalContent) {
                contentText.innerHTML = APP.originalContent;
                initializeTooltips();
            }
            
            var tableKeys = Object.keys(APP.tableData);
            for (var i = 0; i < tableKeys.length; i++) {
                var table = tableKeys[i];
                APP.tableData[table] = JSON.parse(JSON.stringify(APP.originalTableData[table]));
            }
            
            updateAllTableFormats();
        }

        function navigateResults(direction) {
            if (APP.searchMatches.length === 0) return;
            
            APP.currentMatchIndex += direction;
            
            if (APP.currentMatchIndex < 0) {
                APP.currentMatchIndex = APP.searchMatches.length - 1;
            } else if (APP.currentMatchIndex >= APP.searchMatches.length) {
                APP.currentMatchIndex = 0;
            }
            
            highlightCurrentMatch();
        }

        function highlightCurrentMatch() {
            for (var i = 0; i < APP.searchMatches.length; i++) {
                if (i === APP.currentMatchIndex) {
                    APP.searchMatches[i].classList.add('current');
                    APP.searchMatches[i].scrollIntoView({ behavior: 'smooth', block: 'center' });
                } else {
                    APP.searchMatches[i].classList.remove('current');
                }
            }
            
            updateSearchInfo();
        }

        function updateSearchInfo() {
            var info = document.getElementById('searchInfo');
            var prevBtn = document.getElementById('prevBtn');
            var nextBtn = document.getElementById('nextBtn');
            
            if (APP.searchMatches.length > 0) {
                info.textContent = (APP.currentMatchIndex + 1) + ' / ' + APP.searchMatches.length;
                prevBtn.disabled = false;
                nextBtn.disabled = false;
            } else {
                info.textContent = '0 results';
                prevBtn.disabled = true;
                nextBtn.disabled = true;
            }
        }

        function clearSearch() {
            document.getElementById('searchInput').value = '';
            clearSearchHighlights();
            APP.searchMatches = [];
            APP.currentMatchIndex = -1;
            updateSearchInfo();
        }

        // Export data
        function exportData() {
            var dataToExport = {
                tables: APP.tableData,
                tableNames: APP.tableNames,
                exportDate: new Date().toISOString()
            };
            
            var dataStr = JSON.stringify(dataToExport, null, 2);
            var dataBlob = new Blob([dataStr], {type: 'application/json'});
            var url = URL.createObjectURL(dataBlob);
            var link = document.createElement('a');
            link.href = url;
            link.download = 'table-data-export.json';
            link.click();
            URL.revokeObjectURL(url);
        }

        // Import data
        function importData(file) {
            var reader = new FileReader();
            reader.onload = function(e) {
                try {
                    var imported = JSON.parse(e.target.result);
                    if (imported.tables) {
                        APP.tableData = imported.tables;
                        if (imported.tableNames) {
                            APP.tableNames = imported.tableNames;
                        }
                        
                        var tableKeys = Object.keys(APP.tableData);
                        for (var i = 0; i < tableKeys.length; i++) {
                            APP.originalTableData[tableKeys[i]] = JSON.parse(JSON.stringify(APP.tableData[tableKeys[i]]));
                        }
                        
                        initializeDropdown();
                        initializeTables();
                        parseAndConvertReferences();
                        initializeTooltips();
                        
                        alert('Data imported successfully!');
                    } else {
                        alert('Invalid file format');
                    }
                } catch(err) {
                    alert('Error importing file: ' + err.message);
                }
            };
            reader.readAsText(file);
        }

        // Event Listeners
        document.addEventListener('DOMContentLoaded', function() {
            loadPreferences();
            initializeDropdown();
            initializeTables();
            parseAndConvertReferences();
            initializeTooltips();
            updateHistoryDropdown();

            // Show keyboard hint
            setTimeout(function() {
                document.getElementById('keyboardHint').classList.add('visible');
                setTimeout(function() {
                    document.getElementById('keyboardHint').classList.remove('visible');
                }, 5000);
            }, 2000);

            // Theme toggle
            document.getElementById('themeToggle').addEventListener('click', function() {
                document.body.classList.toggle('dark-mode');
                var isDark = document.body.classList.contains('dark-mode');
                document.getElementById('themeIcon').textContent = isDark ? '‚òÄÔ∏è' : 'üåô';
                localStorage.setItem('theme', isDark ? 'dark' : 'light');
            });

            // Font size controls
            document.getElementById('fontIncrease').addEventListener('click', function() {
                var sizes = ['6px', '8px', '10px', '12px', '14px', '16px', '18px'];
                var currentIndex = sizes.indexOf(APP.fontSize);
                if (currentIndex < sizes.length - 1) {
                    document.body.classList.remove('font-size-' + APP.fontSize);
                    APP.fontSize = sizes[currentIndex + 1];
                    document.body.classList.add('font-size-' + APP.fontSize);
                    localStorage.setItem('fontSize', APP.fontSize);
                } else {
                    // Loop back to normal (12px)
                    document.body.classList.remove('font-size-' + APP.fontSize);
                    APP.fontSize = '12px';
                    document.body.classList.add('font-size-' + APP.fontSize);
                    localStorage.setItem('fontSize', APP.fontSize);
                }
            });

            document.getElementById('fontDecrease').addEventListener('click', function() {
                var sizes = ['6px', '8px', '10px', '12px', '14px', '16px', '18px'];
                var currentIndex = sizes.indexOf(APP.fontSize);
                if (currentIndex > 0) {
                    document.body.classList.remove('font-size-' + APP.fontSize);
                    APP.fontSize = sizes[currentIndex - 1];
                    document.body.classList.add('font-size-' + APP.fontSize);
                    localStorage.setItem('fontSize', APP.fontSize);
                } else {
                    // Loop back to normal (12px)
                    document.body.classList.remove('font-size-' + APP.fontSize);
                    APP.fontSize = '12px';
                    document.body.classList.add('font-size-' + APP.fontSize);
                    localStorage.setItem('fontSize', APP.fontSize);
                }
            });

            // Search mode dropdown
            document.getElementById('modeDropdownBtn').addEventListener('click', function(e) {
                e.stopPropagation();
                document.getElementById('modeDropdown').classList.toggle('show');
            });

            var modeItems = document.querySelectorAll('.mode-dropdown-item');
            for (var i = 0; i < modeItems.length; i++) {
                modeItems[i].addEventListener('click', function() {
                    var mode = parseInt(this.getAttribute('data-mode'));
                    APP.currentSearchMode = mode;
                    
                    var allItems = document.querySelectorAll('.mode-dropdown-item');
                    for (var j = 0; j < allItems.length; j++) {
                        allItems[j].classList.remove('active');
                    }
                    this.classList.add('active');
                    
                    document.getElementById('currentMode').textContent = this.textContent;
                    document.getElementById('modeDropdown').classList.remove('show');
                    
                    var searchInput = document.getElementById('searchInput');
                    if (searchInput.value) {
                        performSearch(searchInput.value);
                    }
                });
            }

            // History dropdown
            document.getElementById('historyBtn').addEventListener('click', function(e) {
                e.stopPropagation();
                document.getElementById('historyDropdown').classList.toggle('show');
            });

            document.getElementById('historyDropdown').addEventListener('click', function(e) {
                if (e.target.classList.contains('history-item')) {
                    if (e.target.classList.contains('history-clear')) {
                        APP.searchHistory = [];
                        localStorage.removeItem('searchHistory');
                        updateHistoryDropdown();
                    } else {
                        var searchTerm = e.target.getAttribute('data-search');
                        if (searchTerm) {
                            document.getElementById('searchInput').value = searchTerm;
                            performSearch(searchTerm);
                            document.getElementById('historyDropdown').classList.remove('show');
                        }
                    }
                }
            });

            // Table dropdown
            document.getElementById('tableDropdownBtn').addEventListener('click', function(e) {
                e.stopPropagation();
                document.getElementById('tableDropdown').classList.toggle('show');
            });

            // Bulk controls
            document.getElementById('selectAll').addEventListener('click', function() {
                var checkboxes = document.querySelectorAll('#tableDropdown input[type="checkbox"]');
                for (var i = 0; i < checkboxes.length; i++) {
                    if (!checkboxes[i].checked) {
                        checkboxes[i].checked = true;
                        checkboxes[i].dispatchEvent(new Event('change'));
                    }
                }
            });

            document.getElementById('deselectAll').addEventListener('click', function() {
                var checkboxes = document.querySelectorAll('#tableDropdown input[type="checkbox"]');
                for (var i = 0; i < checkboxes.length; i++) {
                    if (checkboxes[i].checked) {
                        checkboxes[i].checked = false;
                        checkboxes[i].dispatchEvent(new Event('change'));
                    }
                }
            });

            // Checkbox change handler
            document.getElementById('tableDropdown').addEventListener('change', function(e) {
                if (e.target.type === 'checkbox') {
                    var tableKey = e.target.getAttribute('data-table');
                    var tableSection = document.getElementById('tableSection' + tableKey);
                    
                    if (e.target.checked) {
                        APP.selectedTables.push(tableKey);
                        tableSection.classList.add('visible');
                        setTimeout(function() {
                            tableSection.scrollIntoView({ behavior: 'smooth', block: 'start' });
                        }, 100);
                    } else {
                        var index = APP.selectedTables.indexOf(tableKey);
                        if (index > -1) {
                            APP.selectedTables.splice(index, 1);
                        }
                        tableSection.classList.remove('visible');
                    }
                }
            });

            // Format tab buttons and copy
            document.getElementById('tablesContainer').addEventListener('click', function(e) {
                if (e.target.classList.contains('tab-btn')) {
                    var tableKey = e.target.getAttribute('data-table');
                    var format = e.target.getAttribute('data-format');
                    
                    var tabs = document.querySelectorAll('#tableSection' + tableKey + ' .tab-content, #tableSection' + tableKey + ' .table-view');
                    var buttons = document.querySelectorAll('#tableSection' + tableKey + ' .tab-btn');
                    
                    for (var i = 0; i < tabs.length; i++) {
                        tabs[i].classList.remove('active');
                    }
                    for (var i = 0; i < buttons.length; i++) {
                        buttons[i].classList.remove('active');
                    }
                    
                    if (format === 'table') {
                        document.getElementById(tableKey + '-table-view').classList.add('active');
                    } else {
                        document.getElementById(tableKey + '-' + format).classList.add('active');
                    }
                    e.target.classList.add('active');
                }
                
                if (e.target.classList.contains('copy-btn')) {
                    var tableKey = e.target.getAttribute('data-table');
                    var activeTab = document.querySelector('#tableSection' + tableKey + ' .tab-btn.active');
                    var format = activeTab ? activeTab.getAttribute('data-format') : 'json';
                    
                    var content = '';
                    if (format === 'json') {
                        content = toJSON(tableKey);
                    } else if (format === 'csv') {
                        content = toCSV(tableKey);
                    } else if (format === 'markdown') {
                        content = toMarkdown(tableKey);
                    } else if (format === 'table') {
                        content = toCSV(tableKey);
                    }
                    
                    copyToClipboard(content, e.target);
                }
                
                // Table sorting
                if (e.target.tagName === 'TH' && e.target.classList.contains('sortable')) {
                    var tableKey = e.target.getAttribute('data-table');
                    var column = e.target.getAttribute('data-column');
                    
                    var currentSort = APP.sortStates[tableKey][column] || 'none';
                    var newSort = currentSort === 'asc' ? 'desc' : 'asc';
                    
                    // Reset other columns
                    var allHeaders = e.target.parentElement.querySelectorAll('th');
                    for (var i = 0; i < allHeaders.length; i++) {
                        allHeaders[i].classList.remove('sort-asc', 'sort-desc');
                    }
                    
                    e.target.classList.add('sort-' + newSort);
                    APP.sortStates[tableKey][column] = newSort;
                    
                    sortTable(tableKey, column, newSort);
                }
            });

            // Remark links - delegated event for dynamically created elements
            document.addEventListener('click', function(e) {
                var target = e.target;
                if (target.classList.contains('remark-link')) {
                    e.preventDefault();
                    e.stopPropagation();
                    var remarkText = target.nextElementSibling;
                    if (remarkText && remarkText.classList.contains('remark-text')) {
                        remarkText.classList.toggle('visible');
                    }
                }
            }, true);

            // Real-time search with debounce
            document.getElementById('searchInput').addEventListener('input', function(e) {
                var searchTerm = e.target.value.trim();
                debouncedSearch(searchTerm);
            });

            // Navigation buttons
            document.getElementById('prevBtn').addEventListener('click', function() {
                navigateResults(-1);
            });

            document.getElementById('nextBtn').addEventListener('click', function() {
                navigateResults(1);
            });

            document.getElementById('clearBtn').addEventListener('click', clearSearch);

            // Export/Import
            document.getElementById('exportBtn').addEventListener('click', exportData);
            
            document.getElementById('importBtn').addEventListener('click', function() {
                document.getElementById('fileInput').click();
            });
            
            document.getElementById('fileInput').addEventListener('change', function(e) {
                if (e.target.files.length > 0) {
                    importData(e.target.files[0]);
                    e.target.value = '';
                }
            });

            // Back to top button
            document.getElementById('backToTop').addEventListener('click', function() {
                document.getElementById('top').scrollIntoView({ behavior: 'smooth' });
            });

            // Keyboard shortcuts
            document.addEventListener('keydown', function(e) {
                // Ctrl+F or Cmd+F - Focus search
                if ((e.ctrlKey || e.metaKey) && e.key === 'f') {
                    e.preventDefault();
                    document.getElementById('searchInput').focus();
                }
                
                // Escape - Close tooltip or clear search
                if (e.key === 'Escape') {
                    if (APP.currentActiveTooltip) {
                        APP.currentActiveTooltip.classList.remove('active');
                        APP.currentActiveTooltip = null;
                    } else if (document.getElementById('searchInput').value) {
                        clearSearch();
                    }
                    
                    document.getElementById('modeDropdown').classList.remove('show');
                    document.getElementById('historyDropdown').classList.remove('show');
                    document.getElementById('tableDropdown').classList.remove('show');
                }
                
                // Enter - Next search result
                if (e.key === 'Enter' && !e.shiftKey && document.getElementById('searchInput') !== document.activeElement) {
                    if (APP.searchMatches.length > 0) {
                        navigateResults(1);
                    }
                }
                
                // Shift+Enter - Previous search result
                if (e.key === 'Enter' && e.shiftKey) {
                    if (APP.searchMatches.length > 0) {
                        navigateResults(-1);
                    }
                }
                
                // Arrow keys - Navigate search results
                if (e.key === 'ArrowUp' && APP.searchMatches.length > 0) {
                    e.preventDefault();
                    navigateResults(-1);
                }
                
                if (e.key === 'ArrowDown' && APP.searchMatches.length > 0) {
                    e.preventDefault();
                    navigateResults(1);
                }
            });

            // Close tooltips when clicking outside
            document.addEventListener('click', function(e) {
                if (!e.target.closest('.highlight')) {
                    if (APP.currentActiveTooltip) {
                        APP.currentActiveTooltip.classList.remove('active');
                        var remark = APP.currentActiveTooltip.querySelector('.remark-text');
                        if (remark) {
                            remark.classList.remove('visible');
                        }
                        APP.currentActiveTooltip = null;
                    }
                }
            });

            // Close dropdowns when clicking outside
            document.addEventListener('click', function(e) {
                if (!e.target.closest('.search-mode-dropdown')) {
                    document.getElementById('modeDropdown').classList.remove('show');
                }
                if (!e.target.closest('.search-history-dropdown')) {
                    document.getElementById('historyDropdown').classList.remove('show');
                }
                if (!e.target.closest('.dropdown-container')) {
                    document.getElementById('tableDropdown').classList.remove('show');
                }
            });

            // Back to top visibility
            window.addEventListener('scroll', function() {
                var backToTop = document.getElementById('backToTop');
                if (window.pageYOffset > 300) {
                    backToTop.classList.add('visible');
                } else {
                    backToTop.classList.remove('visible');
                }
            });
        });
    </script>
</body>
</html>
